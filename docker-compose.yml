version: '3.4'

networks:
  ros-network:
    driver: bridge
    ipam:
      config:
        - subnet: ${SUBNET}

services:
  mujoco-ws-service:
    tty: true
    image: hoanggiang/mujoco-usd:latest
    build:
      context: ./images/mujoco-ws-image/
      dockerfile: Dockerfile
      args:
        ROS_DISTRO: ${ROS_DISTRO}
    container_name: mujoco-ws-container
    hostname: mujoco-ws
    networks:
      ros-network:
        ipv4_address: ${ROS_IP_CORE}
    environment:
      - DISPLAY
      - QT_X11_NO_MITSHM=1 #fix some QT bugs
      - HOST_IP=${HOST_IP}
      - ROS_MASTER_URI=http://${ROS_IP_CORE}:11311
      - ROS_IP=${ROS_IP_CORE}
      - PXR_PLUGINPATH_NAME=/home/USD/build_scripts/install/share/usd/examples/plugin/usdOntology/resources/
      - PYTHONPATH=/home/USD/build_scripts/install/lib/python
    volumes:
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
      - ./images/mujoco-ws-image/src:/home/mujoco_ws/src:rw
    entrypoint: /entrypoint.bash
    command: sh -c "roslaunch mujoco_sim BoxScenario.launch"